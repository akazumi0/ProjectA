<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Falling Stars">
    <meta name="description" content="G√©rez le flux stellaire, construisez votre empire cosmique et sauvez la Terre">
    <meta name="theme-color" content="#00d4ff">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./src/assets/icon.svg">
    <link rel="icon" type="image/svg+xml" href="./src/assets/icon.svg">
    <title>Falling Stars ‚Äì Foundations of Light</title>

    <!-- Modular CSS Architecture -->
    <link rel="stylesheet" href="./src/css/base.css">
    <link rel="stylesheet" href="./src/css/layout.css">
    <link rel="stylesheet" href="./src/css/ui.css">
    <link rel="stylesheet" href="./src/css/modals.css">
    <link rel="stylesheet" href="./src/css/welcome.css">
</head>
<body>
    <!-- Game Canvas -->
    <canvas id="gameCanvas"></canvas>

    <!-- Combo Fire Overlay -->
    <div id="comboOverlay"></div>

    <!-- Notification System -->
    <div id="notification"></div>

    <!-- ASTRA Dialogue Bubble -->
    <div id="astraDialogue">
        <div class="astra-text" id="astraText"></div>
        <div class="astra-name">‚Äî ASTRA</div>
    </div>

    <!-- Combo Display -->
    <div id="comboDisplay">
        <div class="combo-text">COMBO x<span id="comboCount">1</span></div>
        <div class="combo-multiplier" id="comboMultiplier">+100%</div>
    </div>

    <!-- Flash Mission Banner -->
    <div id="flashMission">
        <div class="flash-title"><span id="flashMissionIcon"></span> <span id="flashMissionName"></span></div>
        <div class="flash-desc" id="flashMissionDesc"></div>
        <div class="flash-progress">
            <div class="flash-progress-bar" id="flashProgressBar" style="width: 0%">
                <span id="flashProgressText">0/0</span>
            </div>
        </div>
        <div class="flash-timer" id="flashTimer">‚è±Ô∏è 00:00</div>
    </div>

    <!-- Right Quest Panel -->
    <div id="rightQuestPanel"></div>

    <!-- Free Lootbox Floating Button -->
    <div id="freeLootboxFloat" style="display: none;" onclick="openFreeLootbox()">
        <div class="lootbox-icon">üì¶</div>
        <div class="lootbox-label">GRATUIT</div>
    </div>

    <!-- Prestige Floating Button -->
    <div id="prestigeFloat" style="display: none;" onclick="openPrestigePopup()">
        <div class="prestige-icon">üå†</div>
        <div class="prestige-label">PRESTIGE</div>
    </div>

    <!-- Lootbox Appear Animation -->
    <div id="lootboxAppearAnim" style="display: none;">
        <div class="lootbox-anim-content">
            <div class="lootbox-anim-icon">üì¶</div>
            <div class="lootbox-anim-text">Coffre Gratuit Disponible !</div>
        </div>
    </div>

    <!-- Story Event Modal -->
    <div id="storyEventModal">
        <div class="story-event-content">
            <div class="story-event-icon" id="storyEventIcon"></div>
            <div class="story-event-title" id="storyEventTitle"></div>
            <div class="story-event-desc" id="storyEventDesc"></div>
            <div id="storyEventChoices"></div>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="welcome">
        <div id="welcomeMain">
            <h1>‚≠ê FALLING STARS ‚≠ê</h1>
            <div class="subtitle">The Last Honest Idle Game</div>

            <div class="manifesto-box">
                <p class="manifesto-text">Un jeu mobile peut-il √™tre √† la fois fun ET √©thique ?</p>
                <div class="manifesto-list">
                    <div class="manifesto-item">‚úì <strong>Z√âRO</strong> publicit√©</div>
                    <div class="manifesto-item">‚úì <strong>Fair Play</strong> garanti (leaderboards s√©par√©s)</div>
                    <div class="manifesto-item">‚úì <strong>Transparent</strong> (formules visibles)</div>
                    <div class="manifesto-item">‚úì <strong>√âducatif</strong> (vraie science spatiale)</div>
                </div>
            </div>

            <div class="tier-choice">
                <p style="font-size: 12px; color: #aaa; margin: 15px 0 10px;">Choisissez votre exp√©rience :</p>
                <button class="tier-btn free-tier active" onclick="selectTier('FREE')">
                    <div class="tier-badge">üÜì</div>
                    <div class="tier-name">Free Player</div>
                    <div class="tier-desc">Jeu complet gratuit</div>
                </button>
                <button class="tier-btn supporter-tier" onclick="selectTier('SUPPORTER')" disabled>
                    <div class="tier-badge">‚≠ê</div>
                    <div class="tier-name">Supporter</div>
                    <div class="tier-desc">$2.99 ‚Ä¢ Cosm√©tiques + QoL</div>
                    <div class="tier-coming">Bient√¥t disponible</div>
                </button>
                <button class="tier-btn fast-tier" onclick="selectTier('FAST_PASS')" disabled>
                    <div class="tier-badge">‚è±Ô∏è</div>
                    <div class="tier-name">Time Traveler</div>
                    <div class="tier-desc">$4.99 ‚Ä¢ Time-savers</div>
                    <div class="tier-coming">Bient√¥t disponible</div>
                </button>
            </div>

            <div class="username-section">
                <p style="font-size: 11px; color: #aaa; margin-bottom: 8px;">Votre nom de Commandant :</p>
                <input type="text" id="usernameInput" placeholder="Commandant..." maxlength="15">
            </div>

            <button class="start-btn" onclick="startGame()">‚ö° COMMENCER L'AVENTURE</button>

            <div class="manifesto-link" onclick="showManifesto()">üìñ Lire notre manifeste complet</div>
        </div>

        <!-- Manifesto Full Screen -->
        <div id="welcomeManifesto" style="display: none;">
            <h2>Notre Manifeste</h2>
            <div class="manifesto-full">
                <h3>Pourquoi "The Last Honest Idle Game" ?</h3>
                <p>Le march√© mobile est satur√© de jeux qui exploitent les joueurs avec des publicit√©s invasives, des achats pay-to-win, et des m√©caniques manipulatrices.</p>

                <h3>Nos Engagements</h3>
                <ul>
                    <li><strong>Transparence Totale</strong> : Toutes les formules du jeu sont accessibles. Pas de bo√Æte noire.</li>
                    <li><strong>Fair Play</strong> : Les joueurs Free, Supporter et Fast Pass ont des leaderboards s√©par√©s.</li>
                    <li><strong>Pas de Dark Patterns</strong> : Pas de FOMO artificiel, pas de timers agressifs, pas de lootboxes payantes.</li>
                    <li><strong>√âducatif</strong> : Chaque technologie est bas√©e sur de vraie science. Apprenez en jouant.</li>
                    <li><strong>Community-Driven</strong> : Vos retours comptent. Le jeu √©volue avec vous.</li>
                </ul>

                <h3>Mon√©tisation √âthique</h3>
                <p>Si vous aimez le jeu, vous pouvez devenir <strong>Supporter</strong> (cosm√©tiques) ou <strong>Time Traveler</strong> (time-savers). Mais le jeu complet est 100% gratuit.</p>

                <p style="margin-top: 20px; font-style: italic; color: #888;">Fait avec ‚ù§Ô∏è par 2 d√©veloppeurs ind√©pendants qui croient qu'un autre gaming mobile est possible.</p>
            </div>
            <button class="start-btn" onclick="hideManifesto()">‚Üê RETOUR</button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal">
        <div class="modal-content">
            <div class="modal-header">PROFIL DU COMMANDANT</div>
            <div class="modal-body">
                <div class="stat-row">
                    <span class="stat-label">Lumen Total</span>
                    <span class="stat-value" id="modalLumen">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Plan√®tes</span>
                    <span class="stat-value" id="modalPlanets">1/3</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Technologies</span>
                    <span class="stat-value" id="modalTechs">0</span>
                </div>

                <div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid var(--color-border);">
                    <div style="font-size: 14px; font-weight: bold; color: var(--color-primary); margin-bottom: 10px; text-align: center;">üìä STATISTIQUES</div>
                </div>

                <div class="stat-row">
                    <span class="stat-label">Temps de jeu</span>
                    <span class="stat-value" id="modalTimePlayed">0s</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Clics totaux</span>
                    <span class="stat-value" id="modalTotalClicks">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Fragments captur√©s</span>
                    <span class="stat-value" id="modalFragmentsCaught">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">B√¢timents construits</span>
                    <span class="stat-value" id="modalBuildingsBuilt">0</span>
                </div>
            </div>
            <button class="close-btn" onclick="closeProfile()">FERMER</button>
        </div>
    </div>

    <!-- Header -->
    <div id="header" style="display: none;">
        <div class="resources">
            <div class="resource" id="playerInfo">
                <span class="profile-icon" onclick="openProfile()" title="Profil">üë§</span>
                <div class="resource-value" id="prestigeLevelDisplay">0</div>
            </div>
            <div class="resource">
                <div>‚≠ê Lumen</div>
                <div class="resource-value" id="lumenVal">0</div>
                <div class="resource-rate" id="lumenRate">+0/s</div>
            </div>
            <div class="resource">
                <div>‚ö° √ânergie</div>
                <div class="resource-value" id="energyVal">0</div>
                <div class="resource-rate" id="energyRate">+0/s</div>
            </div>
            <div class="resource">
                <div>üí• Antimati√®re</div>
                <div class="resource-value" id="antimatterVal">0</div>
                <div class="resource-rate" id="antimatterRate">Rare</div>
            </div>
        </div>
    </div>

    <!-- Left Icon Bar -->
    <div id="leftIconBar" style="display: none;">
        <div class="icon-button" onclick="openModal('daily')" id="dailyIcon">üéÅ</div>
        <div class="icon-button" onclick="openModal('quests')" id="questsIcon">üìú</div>
        <div class="icon-button" onclick="openModal('achievements')" id="achievementsIcon">üèÜ</div>
        <div class="icon-button" onclick="openModal('artifacts')" id="artifactsIcon">üíé</div>
        <div class="icon-button" onclick="openModal('events')" id="eventsIcon">üåü</div>
        <div class="icon-button" onclick="openModal('shop')" id="shopIcon">üè™</div>
        <div class="icon-button" onclick="openModal('settings')" id="settingsIcon">‚öôÔ∏è</div>
    </div>

    <!-- Modals -->
    <!-- Daily Rewards Modal -->
    <div id="dailyModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('daily')">‚úï</button>
            <div class="modal-header">üéÅ R√âCOMPENSES JOURNALI√àRES</div>
            <div class="modal-body">
                <div style="text-align: center; margin: 15px 0;">
                    <div id="dailyDays"></div>
                </div>
                <button class="sidebar-btn green" id="claimDailyBtn" onclick="claimDaily()">COLLECTER</button>
            </div>
        </div>
    </div>

    <!-- Lootbox Modal -->
    <div id="lootboxModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('lootbox')">‚úï</button>
            <div class="modal-header">üì¶ COFFRE GRATUIT</div>
            <div class="modal-body">
                <div id="freeLootboxTimer" class="timer-text">--:--:--</div>
                <div class="reward-text">Disponible toutes les 2 heures</div>
                <button class="sidebar-btn" id="openFreeLootboxBtn" onclick="openFreeLootbox()" disabled>OUVRIR</button>
            </div>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div id="achievementsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('achievements')">‚úï</button>
            <div class="modal-header">üèÜ SUCC√àS</div>
            <div class="modal-body" id="achievementsBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Quests Modal -->
    <div id="questsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('quests')">‚úï</button>
            <div class="modal-header">üìú QU√äTES QUOTIDIENNES</div>
            <div class="modal-body" id="questsBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Events Modal -->
    <div id="eventsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('events')">‚úï</button>
            <div class="modal-header">üåü √âV√âNEMENTS & BOOSTS</div>
            <div class="modal-body" id="eventsBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Artifacts Modal -->
    <div id="artifactsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('artifacts')">‚úï</button>
            <div class="modal-header">üíé ARTEFACTS</div>
            <div class="modal-body" id="artifactsBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Prestige Modal -->
    <div id="prestigeModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">üå† PRESTIGE DISPONIBLE</div>
            <div class="modal-body">
                <div class="info-row">
                    <div class="info-label">Niveau actuel</div>
                    <div class="info-value" id="prestigeLevel">0</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Nouveau niveau</div>
                    <div class="info-value" id="prestigeNewLevel">1</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Nouveau bonus</div>
                    <div class="info-value">+<span id="prestigeBonus">10</span>%</div>
                </div>
                <div style="margin: 15px 0; padding: 10px; background: rgba(255,50,50,0.1); border: 1px solid rgba(255,50,50,0.3); border-radius: 5px; font-size: 11px; text-align: center;">
                    ‚ö†Ô∏è Le prestige r√©initialise tout sauf les technologies
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="sidebar-btn" onclick="dismissPrestigePopup()" style="flex: 1;">PLUS TARD</button>
                    <button class="sidebar-btn gold" onclick="doPrestige()" style="flex: 1;">PRESTIGE</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shop Modal -->
    <div id="shopModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('shop')">‚úï</button>
            <div class="modal-header">üè™ BOUTIQUE</div>
            <div class="modal-body" id="shopBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 450px;">
            <button class="modal-close" onclick="closeModal('settings')">‚úï</button>
            <div class="modal-header">‚öôÔ∏è PARAM√àTRES</div>
            <div class="modal-body">
                <!-- Sound Settings -->
                <div class="settings-section">
                    <div class="settings-header">üîä AUDIO</div>

                    <div class="setting-row">
                        <label class="setting-label">Son activ√©</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="soundToggle" checked onchange="toggleSoundSetting()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-row">
                        <label class="setting-label">Volume SFX</label>
                        <input type="range" id="volumeSFX" class="volume-slider" min="0" max="100" value="50" oninput="updateVolumeSFX(this.value)">
                        <span class="volume-value" id="volumeSFXValue">50%</span>
                    </div>

                    <div class="setting-row">
                        <label class="setting-label">Musique activ√©e</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="musicToggle" checked onchange="toggleMusicSetting()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-row">
                        <label class="setting-label">Volume Musique</label>
                        <input type="range" id="volumeMusic" class="volume-slider" min="0" max="100" value="30" oninput="updateVolumeMusic(this.value)">
                        <span class="volume-value" id="volumeMusicValue">30%</span>
                    </div>
                </div>

                <!-- Haptics Settings -->
                <div class="settings-section">
                    <div class="settings-header">üì≥ VIBRATIONS</div>

                    <div class="setting-row">
                        <label class="setting-label">Retour haptique</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="hapticsToggle" checked onchange="toggleHapticsSetting()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Interface Settings -->
                <div class="settings-section">
                    <div class="settings-header">üé® INTERFACE</div>

                    <div class="setting-row">
                        <label class="setting-label">Langue</label>
                        <select id="languageSelect" class="settings-select" onchange="changeLanguage(this.value)">
                            <option value="fr" selected>Fran√ßais</option>
                            <option value="en">English (Soon)</option>
                        </select>
                    </div>

                    <div class="setting-row">
                        <label class="setting-label">Auto-hide UI</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="uiAutoHideToggle" checked onchange="toggleUIAutoHide()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="settings-section">
                    <div class="settings-header">üíæ DONN√âES</div>

                    <div class="setting-row">
                        <button class="settings-btn" onclick="exportSave()">üì§ Exporter Sauvegarde</button>
                        <button class="settings-btn" onclick="importSave()">üì• Importer Sauvegarde</button>
                    </div>

                    <div class="setting-row">
                        <button class="settings-btn danger" onclick="confirmResetSave()">üóëÔ∏è R√©initialiser Jeu</button>
                    </div>
                </div>

                <!-- About -->
                <div class="settings-section">
                    <div class="settings-header">‚ÑπÔ∏è √Ä PROPOS</div>
                    <div style="font-size: 10px; color: #aaa; text-align: center; padding: 10px;">
                        <p><strong>Falling Stars v1.0.0</strong></p>
                        <p>The Last Honest Idle Game</p>
                        <p style="margin-top: 10px;">Fait avec ‚ù§Ô∏è par 2 d√©veloppeurs ind√©pendants</p>
                        <p style="margin-top: 5px;">Zero pub ‚Ä¢ Fair Play ‚Ä¢ Open Source</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom UI -->
    <div id="bottomUI" style="display: none;">
        <div id="tabs">
            <div class="tab active" onclick="switchTab(0)">D√âFENSE</div>
            <div class="tab" onclick="switchTab(1)">B√ÇTIMENTS</div>
            <div class="tab" onclick="switchTab(2)">TECHNOLOGIES</div>
        </div>

        <div id="defense" class="tab-content active"></div>
        <div id="buildings" class="tab-content"></div>
        <div id="technologies" class="tab-content"></div>
    </div>

    <!-- ES6 Module Entry Point -->
    <script type="module" src="./src/js/main.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Falling Stars">
    <meta name="description" content="G√©rez le flux stellaire, construisez votre empire cosmique et sauvez la Terre">
    <meta name="theme-color" content="#00d4ff">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./src/assets/icon.svg">
    <link rel="icon" type="image/svg+xml" href="./src/assets/icon.svg">
    <title>Falling Stars ‚Äì Foundations of Light</title>

    <!-- Modular CSS Architecture -->
    <link rel="stylesheet" href="./src/css/base.css">
    <link rel="stylesheet" href="./src/css/layout.css">
    <link rel="stylesheet" href="./src/css/ui.css">
    <link rel="stylesheet" href="./src/css/modals.css">
</head>
<body>
    <!-- Game Canvas -->
    <canvas id="gameCanvas"></canvas>

    <!-- Combo Fire Overlay -->
    <div id="comboOverlay"></div>

    <!-- Notification System -->
    <div id="notification"></div>

    <!-- ASTRA Dialogue Bubble -->
    <div id="astraDialogue">
        <div class="astra-text" id="astraText"></div>
        <div class="astra-name">‚Äî ASTRA</div>
    </div>

    <!-- Combo Display -->
    <div id="comboDisplay">
        <div class="combo-text">COMBO x<span id="comboCount">1</span></div>
        <div class="combo-multiplier" id="comboMultiplier">+100%</div>
    </div>

    <!-- Flash Mission Banner -->
    <div id="flashMission">
        <div class="flash-title"><span id="flashMissionIcon"></span> <span id="flashMissionName"></span></div>
        <div class="flash-desc" id="flashMissionDesc"></div>
        <div class="flash-progress">
            <div class="flash-progress-bar" id="flashProgressBar" style="width: 0%">
                <span id="flashProgressText">0/0</span>
            </div>
        </div>
        <div class="flash-timer" id="flashTimer">‚è±Ô∏è 00:00</div>
    </div>

    <!-- Right Quest Panel -->
    <div id="rightQuestPanel"></div>

    <!-- Free Lootbox Floating Button -->
    <div id="freeLootboxFloat" style="display: none;" onclick="openFreeLootbox()">
        <div class="lootbox-icon">üì¶</div>
        <div class="lootbox-label">GRATUIT</div>
    </div>

    <!-- Lootbox Appear Animation -->
    <div id="lootboxAppearAnim" style="display: none;">
        <div class="lootbox-anim-content">
            <div class="lootbox-anim-icon">üì¶</div>
            <div class="lootbox-anim-text">Coffre Gratuit Disponible !</div>
        </div>
    </div>

    <!-- Story Event Modal -->
    <div id="storyEventModal">
        <div class="story-event-content">
            <div class="story-event-icon" id="storyEventIcon"></div>
            <div class="story-event-title" id="storyEventTitle"></div>
            <div class="story-event-desc" id="storyEventDesc"></div>
            <div id="storyEventChoices"></div>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="welcome">
        <h1>‚≠ê FALLING STARS ‚≠ê</h1>
        <div class="subtitle">Foundations of Light</div>
        <p style="font-size: 11px; color: #aaa; margin-bottom: 15px;">Choisissez votre nom de Commandant :</p>
        <input type="text" id="usernameInput" placeholder="Commandant..." maxlength="15">
        <button onclick="startGame()">‚ö° INITIALISER ASTRA</button>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal">
        <div class="modal-content">
            <div class="modal-header">PROFIL DU COMMANDANT</div>
            <div class="modal-body">
                <div class="stat-row">
                    <span class="stat-label">Nom</span>
                    <span class="stat-value" id="modalUsername">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Score Total</span>
                    <span class="stat-value" id="modalScore">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Lumen Total</span>
                    <span class="stat-value" id="modalLumen">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Plan√®tes</span>
                    <span class="stat-value" id="modalPlanets">1/3</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Technologies</span>
                    <span class="stat-value" id="modalTechs">0</span>
                </div>
            </div>
            <button class="close-btn" onclick="closeProfile()">FERMER</button>
        </div>
    </div>

    <!-- Header -->
    <div id="header" style="display: none;">
        <div class="resources">
            <div class="resource" id="playerInfo">
                <span class="profile-icon" onclick="openProfile()" title="Profil">üë§</span>
                <div class="resource-value" id="prestigeLevelDisplay">0</div>
                <div class="resource-rate">Lvl</div>
            </div>
            <div class="resource">
                <div>‚≠ê Lumen</div>
                <div class="resource-value" id="lumenVal">0</div>
                <div class="resource-rate" id="lumenRate">+0/s</div>
            </div>
            <div class="resource">
                <div>‚ö° √ânergie</div>
                <div class="resource-value" id="energyVal">0</div>
                <div class="resource-rate" id="energyRate">+0/s</div>
            </div>
            <div class="resource">
                <div>üí• Antimati√®re</div>
                <div class="resource-value" id="antimatterVal">0</div>
                <div class="resource-rate" id="antimatterRate">Rare</div>
            </div>
        </div>
    </div>

    <!-- Left Icon Bar -->
    <div id="leftIconBar" style="display: none;">
        <div class="icon-button" onclick="openModal('daily')" id="dailyIcon">üéÅ</div>
        <div class="icon-button" onclick="openModal('quests')" id="questsIcon">üìú</div>
        <div class="icon-button" onclick="openModal('achievements')" id="achievementsIcon">üèÜ</div>
        <div class="icon-button" onclick="openModal('artifacts')" id="artifactsIcon">üíé</div>
        <div class="icon-button" onclick="openModal('events')" id="eventsIcon">üåü</div>
        <div class="icon-button" onclick="openModal('prestige')" id="prestigeIcon">üå†</div>
        <div class="icon-button" onclick="openModal('shop')" id="shopIcon">üè™</div>
    </div>

    <!-- Modals -->
    <!-- Daily Rewards Modal -->
    <div id="dailyModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('daily')">‚úï</button>
            <div class="modal-header">üéÅ R√âCOMPENSES JOURNALI√àRES</div>
            <div class="modal-body">
                <div style="text-align: center; margin: 15px 0;">
                    <div id="dailyDays"></div>
                </div>
                <button class="sidebar-btn green" id="claimDailyBtn" onclick="claimDaily()">COLLECTER</button>
            </div>
        </div>
    </div>

    <!-- Lootbox Modal -->
    <div id="lootboxModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('lootbox')">‚úï</button>
            <div class="modal-header">üì¶ COFFRE GRATUIT</div>
            <div class="modal-body">
                <div id="freeLootboxTimer" class="timer-text">--:--:--</div>
                <div class="reward-text">Disponible toutes les 2 heures</div>
                <button class="sidebar-btn" id="openFreeLootboxBtn" onclick="openFreeLootbox()" disabled>OUVRIR</button>
            </div>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div id="achievementsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('achievements')">‚úï</button>
            <div class="modal-header">üèÜ SUCC√àS</div>
            <div class="modal-body" id="achievementsBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Quests Modal -->
    <div id="questsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('quests')">‚úï</button>
            <div class="modal-header">üìú QU√äTES QUOTIDIENNES</div>
            <div class="modal-body" id="questsBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Events Modal -->
    <div id="eventsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('events')">‚úï</button>
            <div class="modal-header">üåü √âV√âNEMENTS & BOOSTS</div>
            <div class="modal-body" id="eventsBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div id="statsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('stats')">‚úï</button>
            <div class="modal-header">üìä STATISTIQUES</div>
            <div class="modal-body" id="statsBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Artifacts Modal -->
    <div id="artifactsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('artifacts')">‚úï</button>
            <div class="modal-header">üíé ARTEFACTS</div>
            <div class="modal-body" id="artifactsBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Prestige Modal -->
    <div id="prestigeModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('prestige')">‚úï</button>
            <div class="modal-header">üå† PRESTIGE</div>
            <div class="modal-body">
                <div class="info-row">
                    <div class="info-label">Niveau actuel</div>
                    <div class="info-value" id="prestigeLevel">0</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Bonus de production</div>
                    <div class="info-value">+<span id="prestigeBonus">0</span>%</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Progression</div>
                    <div class="info-value" id="prestigeProgress">--</div>
                </div>
                <div style="margin: 15px 0; padding: 10px; background: rgba(255,50,50,0.1); border: 1px solid rgba(255,50,50,0.3); border-radius: 5px; font-size: 11px; text-align: center;">
                    ‚ö†Ô∏è Le prestige r√©initialise tout sauf les technologies
                </div>
                <button class="sidebar-btn gold" id="prestigeBtn" onclick="doPrestige()" disabled>PRESTIGE</button>
            </div>
        </div>
    </div>

    <!-- Shop Modal -->
    <div id="shopModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('shop')">‚úï</button>
            <div class="modal-header">üè™ BOUTIQUE</div>
            <div class="modal-body" id="shopBody" style="max-height: 60vh; overflow-y: auto;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Bottom UI -->
    <div id="bottomUI" style="display: none;">
        <div id="tabs">
            <div class="tab active" onclick="switchTab(0)">D√âFENSE</div>
            <div class="tab" onclick="switchTab(1)">B√ÇTIMENTS</div>
            <div class="tab" onclick="switchTab(2)">TECHNOLOGIES</div>
        </div>

        <div id="defense" class="tab-content active"></div>
        <div id="buildings" class="tab-content"></div>
        <div id="technologies" class="tab-content"></div>
    </div>

    <!-- ES6 Module Entry Point -->
    <script type="module" src="./src/js/main.js"></script>
</body>
</html>
